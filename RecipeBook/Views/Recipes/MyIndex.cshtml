@using RecipeBook.ViewModels.Recipes;
@model IEnumerable<RecipeCardViewModel>

@{
    ViewData["Title"] = "Моите рецепти";
    var user = ViewData["User"] as ApplicationUser;
    var currentUserId = ViewData["CurrentUserId"] as string;
    var isFollowing = ViewData["IsFollowing"] as bool? ?? false;
    bool isOwnProfile = user?.Id == currentUserId;
    var followersCount = ViewData["FollowersCount"] as int? ?? 0;
    var followingCount = ViewData["FollowingCount"] as int? ?? 0;

}

@using System.Text.RegularExpressions

<link rel="stylesheet" href="~/css/profile.css" />

<!--  Профилна секция -->
<div class="profile-header d-flex flex-column flex-md-row align-items-start gap-3 p-3 border rounded shadow-sm" style="background-color: #fdfdfd;">
    <img src="@Url.Action("GetProfilePicture", "Users", new { userId = user.Id, pictureVersion = user.ProfilePictureVersion })"
         class="rounded-circle" alt="Профилна снимка"
         style="width: 100px; height: 100px; object-fit: cover; flex-shrink: 0;" />

    <div class="flex-grow-1">
        <h4 class="text-danger fw-bold mb-2">@user.UserName</h4>

        <div class="d-flex flex-column flex-sm-row align-items-start align-items-sm-center gap-2 mb-2">
            @if (isOwnProfile)
            {
                <a asp-action="Create" class="btn btn-sm btn-success">
                    <i class="bi bi-plus-circle"></i> Нова рецепта
                </a>
            }
            else
            {
                <form asp-action="@(isFollowing ? "Unfollow" : "Follow")"
                  asp-controller="Users" method="post" class="m-0">
                    <input type="hidden" name="userId" value="@user.Id" />
                    <button type="submit" class="btn btn-sm btn-success">
                        <i class="bi @(isFollowing ? "bi-person-dash" : "bi-person-plus")"></i>
                        @(isFollowing ? "Отследвай" : "Последвай")
                    </button>
                </form>
            }
        </div>

        <div class="d-flex flex-wrap gap-3 small">

            <span class="d-flex align-items-center gap-1 text-dark fw-semibold">
                <i class="bi bi-journal-text"></i> Рецепти: @Model.Count()
            </span>

            <a asp-controller="Users" asp-action="Followers" asp-route-id="@user.Id"
               class="text-decoration-none d-flex align-items-center gap-1 text-dark fw-semibold">
                <i class="bi bi-people"></i> Последователи: @followersCount
            </a>

            <a asp-controller="Users" asp-action="Following" asp-route-id="@user.Id"
               class="text-decoration-none d-flex align-items-center gap-1 text-dark fw-semibold">
                <i class="bi bi-person-check"></i> Следвани: @followingCount
            </a>
        </div>
    </div>
</div>


<!--  Списък с рецепти -->
<div class="container mt-4">
    <h3>Рецепти на @user.UserName</h3>
    <div class="row mt-3">       
     @foreach (var card in @Model)
    {
        @Html.Partial("_RecipeCard", card)
    }
    </div>
</div>
